<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Koop - devsummit tech talk</title>

		<meta name="description" content="A talk on koop">
		<meta name="author" content="Chris Helm">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Koop</h1>
					<h3>FeatureServices from Anywhere</h3>
					<p>
						<small>Chris Helm / <a href="http://twitter.com/@cwhelm">@cwhelm</a></small>
					</p>
          <aside class="notes"></aside>
				</section>
        
        <section>
          <h2>Rate my talk</h2>
          <h2><a href="http://www.esri.com/events/session-rater?id=90#18995">http://www.esri.com/events/session-rater?id=90#18995</a></h2>
        </section>
        
        <section>
          <p><a href="http://chelm.github.io/presentations/devsummit/2015/koop-tech/#/">http://chelm.github.io/presentations/devsummit/2015/koop-tech/#/</a></p>
        </section>


        <section>
          <h2>The Plan</h2>
          <ul>
            <li>Koop at a high Level</li>
            <li>Anatomy of the Koop System</li>
            <li>Using Koop in production</li>
            <li>The future</li>
          </ul>
          <aside class="notes">
            Give an overview of what we're going to go through. Tell them that my goals is to 3 fold: Convince them that koop is something that matters, how koop works, and show them some of the features we're thinking about.Talks like this are important for me to give, they force me to document what we've built and help people inside and outside the company understand.
          </aside>
        </section>

				<section>
          <section>
					  <h2>High Level</h2>
					  <p>What is Koop?</p>
          </section>
          <section>
            <h2>FeatureServices from APIs</h2>
          </section>
          <section>
            <h2>FeatureServices from Other People's Data</h2>
          </section>
          <section>
            <h2>ETL for APIs</h2>
          </section>
          <section>
            <h2>Open Source!</h2>
            <p><a href="https://github.com/Esri/koop">https://github.com/Esri/koop</a></p>
          </section>
          <section>
            <h2>Node.js Module</h2>
          </section>
          <aside class="notes">Okay. For the next little while we are going to be running thru a forest of awesome. There will be words and terms and ideas that may sound strange, but I can asure you they are in fact, awesome. So to make we realy understand how this system works, we're going to actually run through the forest of awesome a few times during the talk. the effect will be much awesome imprinted on your brains forever.</aside>
				</section>

        <section>
          <section>
            <h2>Why does Koop exist?</h2>
            <aside class="notes">Our customers have customers, and interoperablity is crucial in an ever changing world of data access and requirements. Nothing should block users from using data in the ArcGIS Platform.</aside>
          </section>
          <section>
            <p>What if <a href="https://github.com/chelm/geodata/blob/master/ski_areas.geojson">github geojson</a> could be <a href="http://koop.dc.esri.com/github/chelm/geodata/ski_areas/FeatureServer/0">featureservices?</a></p>  
          </section>
          
          <section>
            <p><a href="http://www.arcgis.com/home/webmap/viewer.html?url=http://koop.dc.esri.com/github/chelm/geodata/ski_areas/FeatureServer/0" target="_blank">We can do things like this...</a></p>  
          </section>

          <section>
            <p>Also becuase our customers have customers</p>
          </section>
        </section>

        <section>
          <section>
            <h2>ArcGIS Open Data</h2>
            <img src="images/opendata1.png"/>
          </section>

          <section>
            <img src="images/opendata.png"/>
            <aside class="notes">Koop may not have actually started with the goal of powering Open Data's exports, but it found home there. Somewhere it was needed and has proven itself useful as a way normalizing data access across many versions of ArcGIS Server. Using koop we can create a common experience across all Server versions, from hosted to 9.* - Koop speaks </aside>
          </section>
          <section>
            <h2>Node.js in production</h2>
          </section>
        </section>

        <section>
          <section>
            <h2>How does Koop work</h2>
          </section>
          <section>
            <img src="images/koop_arch.png">
          </section>
          <aside class="notes"></aside>
        </section> 

        <section>
          <section>
            <h2>Vocabularly</h2>
            <ul>
              <li>koop</li>
              <li>providers</li>
              <li>the cache</li>
              <li>koop applications</li>
            </ul>
          </section>
          <section>
            <h2>The "Koop" module</h2>
            <ul>
              <li>A central data cache (database)</li>
              <li>Shared logic for GeoService's REST</li>
              <li>Speaks GeoJSON</li>
              <li>Exposes Express.js Middleware</li>
            </ul>
          </section>
          <section>
            <h2>"Providers"</h2>
            <ul>
              <li>Speak to APIs</li>
              <li>define routes</li>
              <li>rules for parsing data from an API</li>
              <li>when to expire the cache</li>
              <li>akin to MVC</li>
            </ul>
          </section>
          <section>
            <p><a target="_blank" href="https://data.wa.gov/resource/bbfi-8qfv.json">Socrata JSON</a></p>
					  <pre>
              <code data-trim contenteditable>
[{
  number_of_students: "40",
  school: "Asotin Jr. High",
  county: "Asotin",
  grade: "10",
  location_1: {
    needs_recoding: false,
    longitude: "-117.04779000040804",
    latitude: "46.34058000006712",
    human_address: "{"address":"","city":"Asotin","state":"WA","zip":""}"
  }
},

...]
              </code>
            </pre>
          </section>
          <section>
            <p><a target="_blank" href="http://koop.dc.esri.com/socrata/wastate/bbfi-8qfv">GeoJSON</a></p>
					  <pre>
              <code data-trim contenteditable>
{
  type: "Feature",
  geometry: {
    coordinates: [
      -117.04,
      46.34
    ],
    type: "Point",
  }
  id: 1,
  properties: {
    number_of_students: "40",
    school: "Asotin Jr. High",
    county: "Asotin",
    grade: "10"
  }
}
              </code>
            </pre>
          </section>
          <section>
            <h2>"The Cache"</h2>
            <ul>
              <li>Store data in GeoJSON</li>
              <li>PostgreSQL</li>
              <li>Spatialite</li>
              <li>etc, etc...</li>
            </ul>
          </section>
          <section>
            <h2>"A Koop Application"</h2>
            <ul>
              <li>a deployable app</li>
              <li>aggregates modules into a single unit</li>
              <li>one/many providers sitting on top of a cache</li>
              <li><a target="_blank" href="https://github.com/chelm/koop-sample-app">A Sample Application</a></li>
            </ul>
          </section>
          <aside class="notes">Explain the various peices of the system. More parts make it harder to develop and understand, but ultimately more pliable and usable.</aside>
        </section>

        <section>
          <section>
            <h2>Architecture diagram, again</h2>
            <img src="images/koop_arch2.png">
            <aside class="notes"> ARCH} Show the providers, caches, in a composed system</aside>
          </section>
          <section>
            <img src="images/koop_bubbles.png">
            <aside class="notes"> ARCH} Show the providers, caches, in a composed system</aside>
          </section>
        </section>
            

        <section>
          <h2>Demo Socrata Example</h2>
          <aside class="notes">{TODO 2: Socrata ARCH} Show the data flow from the user request for a feature service to Socrata and back thru koop. Stored a geojson until we expire the cache or decide to drop it.</aside>
        </section>

        <section>
          <section>
            <h2>Node.js</h2>
          </section>
          <section>
            <h2>NPM</h2>
            <p><code>npm install koop*</code></p>
          </section>
          <section>
            <h2>A constellation of Modules</h2>
            <img src="images/node-mods.png"/>
          </section>
          <aside class="notes"> Koop is a constellation of modules that can act as stand alone libraries or when deployed together form a    set of data access APIs that can be highly customed to any particular use case. </aside>
        </section>

        <section>
          <section>
            <h2>Providers</h2>
            <p>API adaptation</p>
          </section>
          <section>
            <h2><a href="https://github.com/chelm/koop-sample-provider" target="_blank">The Koop Sample Provider</a></h2>
          </section>
          <section>
            <h2>Routes</h2>
            <pre><code> 
  var routes = {

    ":method :route": HandlerFn,

    "get /socrata/:id": getData,

    "get /socrata/:id/FeatureServer/*": getFeatureServer

  };
            </code></pre>
          </section>
          <section>
            <h2>Controllers</h2>
            <p> handle requests / responses </p>
            <p> talk to the model </p>
          </section>
          <section>
            <h2>Models</h2>
            <p> talk to APIs  </p>
            <p> talk to the Koop Cache </p>
            <p> return geojson to Controllers</p>
          </section>
          
          <section>
            <p><a href="https://github.com/chelm/koop-github" target="_blank">koop-github</a></p>
            <p><a href="https://github.com/chelm/koop-gist" target="_blank">koop-gist</a></p>
            <p><a href="https://github.com/chelm/koop-socrata" target="_blank">koop-socrata</a></p>
            <p><a href="https://github.com/chelm/koop-ckan" target="_blank">koop-ckan</a></p>
            <p><a href="https://github.com/chelm/koop-vrbo" target="_blank">koop-vrbo</a></p>
            <p><a href="https://github.com/Esri/koop-agol" target="_blank">koop-agol</a></p>
          </section>
          <aside class="notes">The anatomy of a provider. The pattern is the key, let's us build many custom providers from the least amount of code.</aside>

        </section>

        <section>
          <section>
            <h2>The Koop Cache</h2>
            <p>store features, and makes koop friendly</p>
            <ul>
              <li>PostGIS</li>
              <li>Spatialite</li>
              <li>memory</li>
            </ul>
          </section>
          <aside class="notes">Cache is completely optional, and spatially enabled is optional. Just need a place to centralize access and avoid thrashing APIs with limits. Provider models can return data w/o ever knowing a cache exists or not.</aside>
        </section>

				<section>
					<section>
						<h2><a href="https://github.com/Esri/koop/tree/master/lib" target="_blank">Koop Core</a></h2>
						<p></p>
					</section>
					<section>
						<h2>Central logic</h2>
						<p>shared code for providers to tap into</p>
					</section>
					<section>
						<h2>GeoServices Rest</h2>
					</section>
          <aside class="notes">CSV parsing tools, esri json to geojson conversions, etc.</aside>
				</section>
				
        <section>
          <section>
					  <h2>File Exports</h2>
            <p>aka ogr2ogr</p>
            <ul>
              <li><a target="_blank" href="http://localhost:1337/socrata/wastate/42qd-frvg.zip">Shapefile</a></li>
              <li><a target="_blank" href="http://localhost:1337/socrata/wastate/42qd-frvg.csv">CSV</a></li>
              <li><a target="_blank" href="http://localhost:1337/socrata/wastate/42qd-frvg.json">GeoJSON</a></li>
              <li><a target="_blank" href="http://localhost:1337/socrata/wastate/42qd-frvg.kml">KML</a></li>
            </ul>
            <aside class="notes">Talk about more formats... like FGDB, GeoPackage</aside>
          </section>
				</section>

        <section>
          <section>
            <h2>Challenges in Deploying Koop</h2>
          </section>
          <section>
            <h2>Small pieces, many versions</h2>
            <p>little node modules</p>
          </section>
          <section>
            <h2>Need to aggregate modules</h2>
          </section>
          <section>
            <h2>Many platforms...</h2>
            <ul>
              <li>AWS</li>
              <li>Heroku</li>
              <li>Openshift, etc.</li>
            </ul>
          </section>
          <section>
            <h2>Must work on windows</h2>
          </section>
          <aside class="notes"> Koop can be deployed anywhere node.js is supported.</aside>
        </section>

        <section>
          <section>
            <h2>NPM install EVERYTHING</h2>
          </section>
          <section>
            <h2><a target="_blank" href="https://github.com/chelm/koop-sample-app">koop-sample-app</a></h2>
          </section>
        </section>

        <section>
          <section>
            <h2>How we deploy Koop</h2>
            <p>in ArcGIS Open Data</p>
          </section>
          <section>
            <img src="images/koop_deploy1.png" />
          </section>
          <section>
            <h2>AWS / Opsworks </h2>
            <p>Use chef to setup servers, checkout code, etc...</p>
          </section>
          <section>
            <h2>Scaling Koop</h2>
            <p>distributed servers</p>
          </section>
          
          <section>
            <h2>Workers</h2>
            <img src="images/koop_workers.png" />
          </section>
          
          <section>
            <pre><code>
  "export_workers":{
    "redis": {
      "prefix":"export-q",
      "port":6379,
      "host":"127.0.0.1"
    }
  },
  "agol":{
    "request_workers": {
      "redis": {
        "prefix":"q",
        "port":6379,
        "host":"127.0.0.1"
      }
    }
  } 
            </code></pre>
          </section>

          <aside class="notes">create the deployed architecture workers</aside>
        </section>

        <section>
          <h2>Research Time</h2>
          <aside class="notes">How far can we take koop, in what ways does this system help us acheive customer goals, and can it provide new ways of thinking about data access </aside>
        </section>

        <section>
          <section>
            <h2>Koop & OpenStreetMap</h2>
            <a target="_blank" href="http://chelm.github.io/o.skoop.m/">OSM DEMO</a>
          </section>
          <aside class="notes">Can koop make Open Street Map more accessible to Esri/GIS users?</aside>
        </section>

        <section>
          <section>
            <h2>Data Tiles</h2>
          </section>
           <section>
            <h2>PNG, GeoJSON, UTF, Protobuf </h2>
            <a target="_blank" href="http://chelm.github.io/vector-tile-layer/">Tile Demos</a>
          </section>
          <aside class="notes">Vector Tiles are the future for access multilayer raw data on clients. </aside>
        </section>

        


				<!--section>
					<h2>Pretty Code</h2>
					<pre><code data-trim contenteditable>
function linkify( selector ) {
  if( supports3DTransforms ) {

    var nodes = document.querySelectorAll( selector );

    for( var i = 0, len = nodes.length; i &lt; len; i++ ) {
      var node = nodes[i];

      if( !node.className ) {
        node.className += ' roll';
      }
    }
  }
}
					</code></pre>
					<p>Code syntax highlighting courtesy of <a href="http://softwaremaniacs.org/soft/highlight/en/description/">highlight.js</a>.</p>
				</section-->


				<!--section>
					<h2>Speaker View</h2>
					<p>There's a <a href="https://github.com/hakimel/reveal.js#speaker-notes">speaker view</a>. It includes a timer, preview of the upcoming slide as well as your speaker notes.</p>
					<p>Press the <em>S</em> key to try it out.</p>

					<aside class="notes">
						Oh hey, these are some notes. They'll be hidden in your presentation, but you can see them if you open the speaker notes window (hit 's' on your keyboard).
					</aside>
				</section-->

				<!--section>
					<h2>Global State</h2>
					<p>
						Set <code>data-state="something"</code> on a slide and <code>"something"</code>
						will be added as a class to the document element when the slide is open. This lets you
						apply broader style changes, like switching the page background.
					</p>
				</section-->

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// Full list of configuration options available at:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
